<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index it!</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div id="wrapper">
        <div class="container">
            <header id="header">
            <div class="header-content">
                <div>
                    <span class="logo">
                        <span class="symbol"><img src="{{ url_for('static', filename='logo-icon.jpg') }}" alt="Index it! Logo" /></span>
                        <h2>Index it!</h2>
					</span>
                    <div style="position: relative;">
                        <h1 id="indexName" class="index-name-clickable" onclick="showDatabaseSwitcher()">Create and manage your book index offline</h1>

                        <!-- Database Switcher Dropdown (hidden by default) -->
                        <div id="databaseSwitcher" class="database-switcher" style="display: none;">
                            <div class="database-list">
                                <h3>Switch Index</h3>
                                <ul>
                                    <!-- Populated dynamically via JavaScript -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hamburger Menu Button -->
            <nav id="headerNav">
                <ul>
                    <li><a href="#menu" aria-label="Menu"><span class="sr-only">Menu</span></a></li>
                </ul>
            </nav>
        </header>

        <!-- Tab Navigation -->
        <div style="text-align: center;">
            <div class="tabs">
                <button class="tab-button active" onclick="switchTab('add')"><span>Add Entry</span></button>
                <button class="tab-button" onclick="switchTab('view')"><span>View Entries</span></button>
                <button class="tab-button" onclick="switchTab('notes')"><span>View Notes</span></button>
                <button class="tab-button" onclick="switchTab('books')"><span>Books</span></button>
                <button class="tab-button" onclick="switchTab('tools')"><span>Tools</span></button>
                <button class="tab-button" onclick="switchTab('settings')"><span>Settings</span></button>
            </div>
        </div>

        <!-- Add Entry Tab -->
        <div id="tab-add" class="tab-content active">
        <div class="card compact">
            <h2>Add New Entry</h2>
            <div id="message" class="message"></div>
            <form id="addForm">
                <div class="form-row">
                    <div class="form-group form-group-term">
                        <label for="term">Term:</label>
                        <div class="autocomplete-wrapper">
                            <input type="text" id="term" name="term" required
                                   placeholder="e.g., machine learning" autofocus
                                   autocomplete="off">
                            <div id="autocomplete-list" class="autocomplete-items"></div>
                        </div>
                        <small style="display: block; margin-top: 0.25rem;">Leave blank to add only a note</small>
                    </div>

                    <div class="form-group form-group-ref">
                        <label>Reference:</label>
                        <div class="reference-inputs">
                            <select id="book" name="book" class="ref-input book-select">
                                <option value="">Book</option>
                            </select>
                            <span class="ref-separator">:</span>
                            <input type="text" id="page" name="page"
                                   placeholder="Start" class="ref-input" style="width: 65px;"
                                   pattern="[0-9]*" inputmode="numeric">
                            <span class="ref-separator">-</span>
                            <input type="text" id="pageEnd" name="pageEnd"
                                   placeholder="End" class="ref-input" style="width: 65px;"
                                   pattern="[0-9]*" inputmode="numeric">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="notes">Notes:</label>
                    <textarea id="notes" name="notes" rows="3"
                              placeholder="Enter notes about this term..."></textarea>
                    <small>Notes are associated with the term, not specific page references</small>
                </div>

                <button type="submit" class="btn btn-primary">Add Entry</button>
            </form>
        </div>

        <div class="card">
            <h2 style="font-size: 1.3rem;">Recently Added Terms</h2>
            <div id="recentEntriesList" class="recent-entries-list">
                <p class="loading">Loading...</p>
            </div>
            <div id="recentEntriesShowMore" style="display: none; margin-top: 0.5rem;">
                <button class="btn btn-secondary" onclick="showMoreRecentEntries()" style="width: 100%; padding: 0.35rem;">
                    Show More
                </button>
            </div>
        </div>
        </div>

        <!-- View Entries Tab -->
        <div id="tab-view" class="tab-content">
        <div class="card">
            <div class="toolbar">
                <h2>Index Entries</h2>
            </div>
            <div id="viewEntriesMessage" class="message"></div>

            <!-- Filter Bar -->
            <div class="filter-bar">
                <div class="form-group" style="margin-bottom: 0;">
                    <label for="bookFilter">Filter by Book:</label>
                    <select id="bookFilter" class="ref-input book-select" style="min-width: 150px;">
                        <option value="">All Books</option>
                    </select>
                </div>
                <input type="text" id="searchInput" placeholder="Search terms..."
                       class="search-box">
                <button onclick="refreshEntries()" class="btn btn-secondary">Refresh</button>
            </div>

            <!-- Letter Navigation -->
            <div id="letterNav" class="letter-nav">
                <!-- Will be populated by JavaScript -->
            </div>

            <div id="entriesList" class="entries-list">
                <p class="loading">Loading...</p>
            </div>
            <div id="stats" class="stats"></div>
        </div>
        </div>

        <!-- Notes Tab -->
        <div id="tab-notes" class="tab-content">
        <div class="card">
            <div class="toolbar">
                <h2>Notes</h2>
            </div>

            <!-- Filter Bar with Search -->
            <div class="filter-bar">
                <input type="text" id="notesSearchInput" placeholder="Search notes..."
                       class="search-box">
                <button onclick="refreshNotes()" class="btn btn-secondary">Refresh</button>
            </div>

            <!-- Letter Navigation -->
            <div id="notesLetterNav" class="letter-nav">
                <!-- Will be populated by JavaScript -->
            </div>

            <div id="notesList" class="notes-list">
                <p class="loading">Loading...</p>
            </div>

            <div id="notesStats" class="stats"></div>
        </div>
        </div>

        <!-- Books Tab -->
        <div id="tab-books" class="tab-content">
        <div class="card">
            <h2>Book Management</h2>
            <div id="bookManagementMessage" class="message"></div>
            <p>Manage the books in your index</p>

            <div id="booksList" class="books-list"></div>

            <h3>Add New Book</h3>
            <div id="addBookMessage" class="message"></div>
            <div class="book-form">
                <div class="form-group">
                    <label for="newBookNumber">Book Number:</label>
                    <input type="text" id="newBookNumber" placeholder="1">
                </div>
                <div class="form-group">
                    <label for="newBookName">Book Name:</label>
                    <input type="text" id="newBookName" placeholder="Volume 1">
                </div>
                <div class="form-group">
                    <label for="newBookPages">Page Count:</label>
                    <input type="text" id="newBookPages" placeholder="500">
                </div>
                <button class="btn btn-primary" onclick="addBook()">Add Book</button>
            </div>
        </div>
        </div>

        <!-- Tools Tab -->
        <div id="tab-tools" class="tab-content">
        <h2 style="margin-bottom: 1.5rem; text-transform: uppercase; color: var(--text-color); font-size: 1.5rem; letter-spacing: 0.2em;">Tools</h2>

        <!-- Import Section -->
        <div class="card">
            <h3 class="collapsible-heading" onclick="toggleToolsSection('import')">
                <span id="importToggle">‚ñ∂</span> Import from CSV
            </h3>
            <div id="importContainer" class="collapsible-container collapsed">
                <div id="importMessage" class="message"></div>
                <p>Paste your CSV data below. Each line can have multiple references for the same term. <a href="#" onclick="showCsvHelpModal(); return false;">Click here for more help.</a></p>
                <form id="importForm">
                    <div class="form-group">
                        <label for="csvData">CSV Data:</label>
                        <textarea id="csvData" name="csvData" rows="15"
                                  placeholder="Paste CSV data here, one entry per line&#10;Format: term,reference1,reference2,...&#10;&#10;Examples:&#10;machine learning,1:42&#10;neural networks,2:15-18,2:25,3:10&#10;deep learning,1:50,1:75-80"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Import Entries</button>
                </form>
                <div id="importResults" class="import-results"></div>
            </div>
        </div>

        <!-- Export Section -->
        <div class="card">
            <h3 class="collapsible-heading" onclick="toggleToolsSection('export')">
                <span id="exportToggle">‚ñ∂</span> Export
            </h3>
            <div id="exportContainer" class="collapsible-container collapsed">
                <h4 style="margin-top: 1.5rem;">Export Index</h4>
                <p>Download your complete index:</p>
                <div style="display: flex; gap: 1rem; align-items: center; margin-top: 0.5rem;">
                    <select id="indexExportFormat" class="filter-select" style="flex: 0 0 200px;">
                        <option value="pdf">PDF</option>
                        <option value="plain">Plain Text</option>
                        <option value="markdown">Markdown</option>
                        <option value="latex">LaTeX</option>
                        <option value="csv">CSV</option>
                        <option value="excel">Excel</option>
                    </select>
                    <button onclick="exportIndexFromDropdown()" class="btn btn-primary">
                        Export Index
                    </button>
                </div>

                <h4 style="margin-top: 1.5rem;">Export Notes</h4>
                <p>Download your notes only:</p>
                <div style="display: flex; gap: 1rem; align-items: center; margin-top: 0.5rem;">
                    <select id="notesExportFormat" class="filter-select" style="flex: 0 0 200px;">
                        <option value="pdf">PDF</option>
                        <option value="txt">Plain Text</option>
                        <option value="markdown">Markdown</option>
                        <option value="latex">LaTeX</option>
                        <option value="csv">CSV</option>
                        <option value="excel">Excel</option>
                    </select>
                    <button onclick="exportNotesFromDropdown()" class="btn btn-primary">
                        Export Notes
                    </button>
                </div>
            </div>
        </div>

        <!-- Gap Analysis Section -->
        <div class="card">
            <h3 class="collapsible-heading" onclick="toggleToolsSection('gaps')">
                <span id="gapsToggle">‚ñ∂</span> Gap Analysis
            </h3>
            <div id="gapsContainer" class="collapsible-container collapsed">
                <p>Identify pages that may not have been indexed for each registered book. Click on missing pages to create a reference or exclude them from the analysis.</p>

                <div id="gapAnalysisResults" class="gap-results"></div>
            </div>
        </div>
        </div>

        <!-- Settings Tab -->
        <div id="tab-settings" class="tab-content">
        <div class="card">
            <h2>Settings</h2>

            <div class="settings-section">
                <h3>Index Settings</h3>
                <div id="indexSettingsMessage" class="message"></div>
                <div class="form-group">
                    <label for="settingsIndexName">Index Name:</label>
                    <input type="text" id="settingsIndexName" placeholder="My Book Index">
                </div>

                <div class="custom-properties-form" style="margin-top: 1.5rem;">
                    <div class="form-row" style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        <div class="form-group" style="flex: 1; margin: 0;">
                            <label for="propertyName">Custom Property:</label>
                            <input type="text" id="propertyName" placeholder="e.g., Author, Publisher, Edition">
                        </div>
                        <div class="form-group" style="flex: 1; margin: 0;">
                            <label for="propertyValue">Value:</label>
                            <input type="text" id="propertyValue" placeholder="e.g., John Smith">
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="saveAllSettings()">Save</button>

                <div id="customPropertiesTable" class="custom-properties-table" style="margin-top: 1rem;">
                    <!-- Properties will be loaded here -->
                </div>

                <small style="display: block; margin-top: 0.5rem;">Add metadata like author, publisher, or edition to your index. Click a property to edit, drag to reorder.</small>
            </div>

            <div class="settings-section">
                <h3>Appearance</h3>
                <div id="colorSchemeMessage" class="message"></div>
                <div class="form-group">
                    <label for="colorScheme">Accent Color:</label>
                    <select id="colorScheme" class="color-scheme-select" onchange="changeColorScheme()">
                        <option value="#f2849e" data-name="Coral Pink" style="background-color: #f2849e;">Coral Pink</option>
                        <option value="#84f2de" data-name="Teal" style="background-color: #84f2de;">Teal</option>
                        <option value="#c9a961" data-name="Gold" style="background-color: #c9a961;">Gold</option>
                        <option value="#84c4f2" data-name="Blue" style="background-color: #84c4f2;">Blue</option>
                        <option value="#f2a063" data-name="Orange" style="background-color: #f2a063;">Orange</option>
                    </select>
                </div>
                <small>Choose an accent color for buttons, links, and highlights</small>
            </div>

            <div class="settings-section">
                <h3>Index Management</h3>
                <div class="form-group" style="margin-bottom: 0;">
                    <label for="indexManagementAction">Action:</label>
                    <div style="display: flex; gap: 1rem; align-items: flex-start;">
                        <select id="indexManagementAction" class="ref-input book-select" style="min-width: 200px;">
                            <option value="">Select an action...</option>
                            <option value="create">Create New Index</option>
                            <option value="backup">Backup Index</option>
                            <option value="import">Import Index</option>
                            <option value="archive">Archive Index</option>
                        </select>
                        <button class="btn btn-primary" onclick="executeIndexManagementAction()">Go</button>
                    </div>
                </div>
                <small>Create, backup, import, or archive your indexes</small>
            </div>
        </div>
        </div>

        <!-- Edit Modal -->
        <div id="editModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Edit Reference</h2>
                    <button class="modal-close" onclick="closeEditModal()">&times;</button>
                </div>
                <form id="editForm">
                    <div class="form-group">
                        <label for="editTerm">Term:</label>
                        <input type="text" id="editTerm" name="editTerm">
                    </div>

                    <input type="hidden" id="editOldReference" name="editOldReference">

                    <div class="form-group">
                        <label>Updated Reference:</label>
                        <div class="reference-inputs">
                            <select id="editBook" name="editBook" required class="ref-input book-select">
                                <option value="">Book</option>
                            </select>
                            <span class="ref-separator">:</span>
                            <input type="text" id="editPage" name="editPage" required
                                   placeholder="Start" class="ref-input" style="width: 65px;"
                                   pattern="[0-9]*" inputmode="numeric">
                            <span class="ref-separator">-</span>
                            <input type="text" id="editPageEnd" name="editPageEnd"
                                   placeholder="End" class="ref-input" style="width: 65px;"
                                   pattern="[0-9]*" inputmode="numeric">
                        </div>
                        <small>Format: book:page or book:start-end</small>
                    </div>

                    <div class="form-group">
                        <label for="editNotes">Notes:</label>
                        <textarea id="editNotes" name="editNotes" rows="4"
                                  placeholder="Enter notes about this term..."></textarea>
                        <small>Notes are associated with the term, not specific page references</small>
                    </div>

                    <div class="modal-actions">
                        <button type="submit" class="btn btn-primary">Update</button>
                        <button type="button" class="btn btn-danger" onclick="deleteReferenceFromModal()">Delete</button>
                        <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Edit Notes Modal -->
        <div id="editNotesModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Edit Notes</h2>
                    <button class="modal-close" onclick="closeEditNotesModal()">&times;</button>
                </div>
                <form id="editNotesForm">
                    <div class="form-group">
                        <label for="editNotesTerm">Term:</label>
                        <input type="text" id="editNotesTerm" name="editNotesTerm" readonly>
                    </div>

                    <div class="form-group">
                        <label for="editNotesText">Notes:</label>
                        <textarea id="editNotesText" name="editNotesText" rows="8"
                                  placeholder="Enter notes about this term..."></textarea>
                    </div>

                    <div class="modal-actions">
                        <button type="submit" class="btn btn-primary">Update</button>
                        <button type="button" class="btn btn-danger" onclick="deleteNotesFromModal()">Delete Notes</button>
                        <button type="button" class="btn btn-secondary" onclick="closeEditNotesModal()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Gap Range Action Modal -->
        <div id="gapActionModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="gapActionTitle">Missing Pages</h2>
                    <button class="modal-close" onclick="closeGapActionModal()">&times;</button>
                </div>
                <div style="padding: 1rem 0;">
                    <p id="gapActionMessage" style="margin-bottom: 1.5rem; color: var(--text-color);"></p>
                    <div class="modal-actions" style="justify-content: center; gap: 1rem;">
                        <button type="button" class="btn btn-primary" onclick="gapActionCreateReference()">
                            Create Reference
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="gapActionExclude()">
                            Exclude from Analysis
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="closeGapActionModal()">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Re-include Exclusion Modal -->
        <div id="reincludeModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="reincludeTitle">Re-include Pages</h2>
                    <button class="modal-close" onclick="closeReincludeModal()">&times;</button>
                </div>
                <div style="padding: 1rem 0;">
                    <p id="reincludeMessage" style="margin-bottom: 1.5rem; color: var(--text-color);"></p>
                    <div class="modal-actions" style="justify-content: center; gap: 1rem;">
                        <button type="button" class="btn btn-primary" onclick="confirmReinclude()">
                            ‚úì Re-include Pages
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="closeReincludeModal()">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Book Modal -->
        <div id="editBookModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Edit Book</h2>
                    <button class="modal-close" onclick="closeEditBookModal()">&times;</button>
                </div>
                <form id="editBookForm">
                    <input type="hidden" id="editBookOldNumber" name="editBookOldNumber">

                    <div class="form-group">
                        <label for="editBookNumber">Book Number:</label>
                        <input type="text" id="editBookNumber" name="editBookNumber" required>
                    </div>

                    <div class="form-group">
                        <label for="editBookName">Book Name:</label>
                        <input type="text" id="editBookName" name="editBookName" required>
                    </div>

                    <div class="form-group">
                        <label for="editBookPages">Page Count:</label>
                        <input type="text" id="editBookPages" name="editBookPages"
                               pattern="[0-9]*" inputmode="numeric">
                    </div>

                    <div class="modal-actions">
                        <button type="submit" class="btn btn-primary">Update Book</button>
                        <button type="button" class="btn btn-danger" onclick="deleteBookFromModal()">Delete Book</button>
                        <button type="button" class="btn btn-secondary" onclick="closeEditBookModal()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Book Modal -->
        <div id="addBookModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Add New Book</h2>
                    <button class="modal-close" onclick="closeAddBookModal()">&times;</button>
                </div>
                <form id="addBookModalForm">
                    <input type="hidden" id="addBookSource" name="addBookSource">

                    <div class="form-group">
                        <label for="addBookModalNumber">Book Number:</label>
                        <input type="text" id="addBookModalNumber" name="addBookModalNumber" required>
                    </div>

                    <div class="form-group">
                        <label for="addBookModalName">Book Name:</label>
                        <input type="text" id="addBookModalName" name="addBookModalName" required>
                    </div>

                    <div class="form-group">
                        <label for="addBookModalPages">Page Count:</label>
                        <input type="text" id="addBookModalPages" name="addBookModalPages"
                               pattern="[0-9]*" inputmode="numeric">
                    </div>

                    <div class="modal-actions">
                        <button type="submit" class="btn btn-primary">Add Book</button>
                        <button type="button" class="btn btn-secondary" onclick="closeAddBookModal()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- About Modal -->
        <div id="aboutModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>About Index it!</h2>
                    <button class="modal-close" onclick="closeAboutModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <p style="font-size: 1.1em; margin-bottom: 1em;"><strong>Index it!</strong> - Create and manage your book index offline</p>

                    <p style="margin-bottom: 1.5em; color: var(--secondary-color);">
                        <strong>Version:</strong> 1.0 &nbsp;|&nbsp; <strong>Year:</strong> 2026
                    </p>

                    <p style="font-style: italic; color: var(--primary-color); margin-bottom: 2em;">
                        Build your exam reference, fast ‚Ä¢ Your open-book advantage
                    </p>

                    <h3 style="margin-top: 1.5em; margin-bottom: 0.75em; color: var(--text-color);">Features</h3>
                    <ul style="list-style: none; padding-left: 0; margin-bottom: 1.5em;">
                        <li style="padding: 0.4em 0;">üìö Multi-book index management</li>
                        <li style="padding: 0.4em 0;">üìù Term tracking with notes</li>
                        <li style="padding: 0.4em 0;">üîç Fast search and filtering</li>
                        <li style="padding: 0.4em 0;">üìä Gap analysis for coverage tracking</li>
                        <li style="padding: 0.4em 0;">üíæ Export to LaTeX, PDF, Markdown, Plain Text</li>
                        <li style="padding: 0.4em 0;">üåê Works completely offline</li>
                    </ul>

                    <h3 style="margin-top: 1.5em; margin-bottom: 0.75em; color: var(--text-color);">Technology</h3>
                    <p style="margin-bottom: 1em;">
                        Built with Python Flask, SQLite, and vanilla JavaScript. No frameworks, no tracking, no cloud dependencies.
                    </p>

                    <p style="margin-top: 1.5em; font-size: 0.9em; color: var(--secondary-color);">
                        Template design by <a href="http://html5up.net" target="_blank" rel="noopener" style="color: var(--primary-color);">HTML5 UP</a>
                    </p>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAboutModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- Help Modal -->
        <div id="helpModal" class="modal">
            <div class="modal-content" style="max-width: 700px;">
                <div class="modal-header">
                    <h2>Help & Keyboard Shortcuts</h2>
                    <button class="modal-close" onclick="closeHelpModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <h3 style="margin-top: 0; margin-bottom: 1em; color: var(--text-color);">Keyboard Shortcuts</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 2em;">
                        <thead>
                            <tr style="border-bottom: 2px solid var(--border-color);">
                                <th style="text-align: left; padding: 0.75em 1em; font-weight: 700;">Key</th>
                                <th style="text-align: left; padding: 0.75em 1em; font-weight: 700;">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 0.75em 1em;"><code style="background: var(--hover-color); padding: 0.2em 0.5em; border-radius: 3px;">1-6</code></td>
                                <td style="padding: 0.75em 1em;">Navigate to tabs (1=Add Entry, 2=View, 3=Notes, 4=Books, 5=Tools, 6=Settings)</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 0.75em 1em;"><code style="background: var(--hover-color); padding: 0.2em 0.5em; border-radius: 3px;">/</code></td>
                                <td style="padding: 0.75em 1em;">Focus search or term input</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 0.75em 1em;"><code style="background: var(--hover-color); padding: 0.2em 0.5em; border-radius: 3px;">Esc</code></td>
                                <td style="padding: 0.75em 1em;">Close modals or hamburger menu</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3 style="margin-top: 1.5em; margin-bottom: 1em; color: var(--text-color);">Quick Start Guide</h3>

                    <h4 style="margin-top: 1em; margin-bottom: 0.5em; font-size: 1em; color: var(--primary-color);">1. Add Books</h4>
                    <p style="margin-bottom: 1em;">Go to the <strong>Books</strong> tab and add your textbooks with their numbers and versions.</p>

                    <h4 style="margin-top: 1em; margin-bottom: 0.5em; font-size: 1em; color: var(--primary-color);">2. Create Index Entries</h4>
                    <p style="margin-bottom: 1em;">On the <strong>Add Entry</strong> tab, enter terms with book:page references (e.g., "1:42" or "2:15-18" for page ranges).</p>

                    <h4 style="margin-top: 1em; margin-bottom: 0.5em; font-size: 1em; color: var(--primary-color);">3. Add Notes</h4>
                    <p style="margin-bottom: 1em;">Add study notes to any term. View all notes in the <strong>Notes</strong> tab.</p>

                    <h4 style="margin-top: 1em; margin-bottom: 0.5em; font-size: 1em; color: var(--primary-color);">4. Export Your Index</h4>
                    <p style="margin-bottom: 1em;">Use the <strong>Tools</strong> tab to export your index to LaTeX, PDF, or other formats.</p>

                    <h4 style="margin-top: 1em; margin-bottom: 0.5em; font-size: 1em; color: var(--primary-color);">5. Gap Analysis</h4>
                    <p style="margin-bottom: 1em;">Check which pages aren't indexed yet in the <strong>Tools</strong> tab under Gap Analysis.</p>

                    <h3 style="margin-top: 1.5em; margin-bottom: 1em; color: var(--text-color);">Tips</h3>
                    <ul style="list-style: disc; padding-left: 1.5em;">
                        <li style="margin-bottom: 0.5em;">Use the autocomplete on the term field to quickly reference existing terms</li>
                        <li style="margin-bottom: 0.5em;">Click references to edit them directly from the View Entries tab</li>
                        <li style="margin-bottom: 0.5em;">Export your database regularly from the Settings tab as a backup</li>
                    </ul>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeHelpModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- CSV Help Modal -->
        <div id="csvHelpModal" class="modal">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header">
                    <h2>CSV Format Help</h2>
                    <button class="modal-close" onclick="closeCsvHelpModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <h3 style="margin-top: 0; margin-bottom: 1em; color: var(--text-color);">Format</h3>
                    <p style="margin-bottom: 1em;"><code style="background: #f5f5f5; padding: 0.2em 0.5em; border-radius: 3px;">term,reference1,reference2,...</code></p>

                    <p style="margin-bottom: 1em;">References can be:</p>
                    <ul style="list-style: disc; padding-left: 1.5em; margin-bottom: 1.5em;">
                        <li style="margin-bottom: 0.5em;"><code style="background: #f5f5f5; padding: 0.2em 0.5em; border-radius: 3px;">book:page</code> for single pages</li>
                        <li style="margin-bottom: 0.5em;"><code style="background: #f5f5f5; padding: 0.2em 0.5em; border-radius: 3px;">book:start-end</code> for page ranges</li>
                    </ul>

                    <h3 style="margin-top: 1.5em; margin-bottom: 1em; color: var(--text-color);">Examples</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 1em;">
                        <tbody>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 0.75em; font-family: monospace; font-size: 0.9em; color: var(--secondary-color);">machine learning,1:42</td>
                                <td style="padding: 0.75em; color: var(--text-color);">Single reference</td>
                            </tr>
                            <tr style="border-bottom: 1px solid var(--border-color);">
                                <td style="padding: 0.75em; font-family: monospace; font-size: 0.9em; color: var(--secondary-color);">neural networks,2:15-18,2:25,3:10</td>
                                <td style="padding: 0.75em; color: var(--text-color);">Multiple references</td>
                            </tr>
                            <tr>
                                <td style="padding: 0.75em; font-family: monospace; font-size: 0.9em; color: var(--secondary-color);">deep learning,1:50,1:75-80</td>
                                <td style="padding: 0.75em; color: var(--text-color);">Mixed formats</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeCsvHelpModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- Edit Property Modal -->
        <div id="editPropertyModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <h2>Edit Custom Property</h2>
                    <button class="modal-close" onclick="closeEditPropertyModal()">&times;</button>
                </div>
                <form id="editPropertyForm" onsubmit="saveEditedProperty(event)">
                    <div class="modal-body">
                        <input type="hidden" id="editPropertyModalId" value="">
                        <div class="form-group">
                            <label for="editPropertyModalName">Custom Property:</label>
                            <input type="text" id="editPropertyModalName" required>
                        </div>
                        <div class="form-group">
                            <label for="editPropertyModalValue">Value:</label>
                            <input type="text" id="editPropertyModalValue" required>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button type="submit" class="btn btn-primary">Save</button>
                        <button type="button" class="btn btn-danger" onclick="deletePropertyFromModal()">Delete</button>
                        <button type="button" class="btn btn-secondary" onclick="closeEditPropertyModal()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Import Index Modal -->
        <div id="importDatabaseModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <h2>Import Index</h2>
                    <button class="modal-close" onclick="closeImportDatabaseModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Upload an existing Index it! index file (.db)</p>
                    <div id="importDatabaseMessage" class="message"></div>
                    <form id="importDatabaseForm" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="databaseFile">Index File (.db):</label>
                            <input type="file" id="databaseFile" name="file" accept=".db" required>
                        </div>
                        <div class="modal-actions">
                            <button type="submit" class="btn btn-primary">Import</button>
                            <button type="button" class="btn btn-secondary" onclick="closeImportDatabaseModal()">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Create Index Modal -->
        <div id="createDatabaseModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <h2>Create New Index</h2>
                    <button class="modal-close" onclick="closeCreateDatabaseModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Create a new empty index</p>
                    <div id="createDatabaseMessage" class="message"></div>
                    <form id="createDatabaseForm">
                        <div class="form-group">
                            <label for="newDatabaseName">Index Name:</label>
                            <input type="text" id="newDatabaseName" placeholder="e.g., CFA Level 2" required>
                        </div>
                        <div class="modal-actions">
                            <button type="submit" class="btn btn-primary">Create</button>
                            <button type="button" class="btn btn-secondary" onclick="closeCreateDatabaseModal()">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Get Started Modal -->
        <div id="getStartedModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <h2>Welcome to Index it!</h2>
                </div>
                <div class="modal-body">
                    <p style="margin-bottom: 1.5em;">Create and manage your book index offline. Let's get you started by setting up your first index.</p>

                    <div id="getStartedMessage" class="message"></div>

                    <form id="getStartedForm">
                        <div class="form-group">
                            <label for="getStartedIndexName">Index Name:</label>
                            <input type="text" id="getStartedIndexName" placeholder="e.g., CFA Level 2, GIAC GSEC" required>
                            <small>Give your index a name to identify it</small>
                        </div>

                        <div class="form-group">
                            <label for="getStartedBookNumber">First Book Number:</label>
                            <input type="text" id="getStartedBookNumber" value="1" required>
                            <small>Usually "1" for your first book</small>
                        </div>

                        <div class="form-group">
                            <label for="getStartedBookName">First Book Name:</label>
                            <input type="text" id="getStartedBookName" placeholder="e.g., Volume 1, Study Guide" required>
                        </div>

                        <div class="form-group">
                            <label for="getStartedBookPages">Page Count:</label>
                            <input type="text" id="getStartedBookPages" placeholder="e.g., 500" pattern="[0-9]*" inputmode="numeric">
                            <small>Optional - used for gap analysis</small>
                        </div>

                        <p style="margin-top: 1.5em; font-size: 0.9em; color: var(--secondary-color);">
                            You can change these settings later in the <strong>Settings</strong> section, and add more books in the <strong>Books</strong> section.
                        </p>

                        <div class="modal-actions">
                            <button type="submit" class="btn btn-primary">Get Started</button>
                        </div>
                    </form>

                    <div style="margin-top: 1.5em; padding-top: 1.5em; border-top: 1px solid var(--border-color); text-align: center;">
                        <p style="font-size: 0.9em; color: var(--text-color); margin-bottom: 0.5em;">Already have an index?</p>
                        <a href="#" onclick="closeGetStartedModal(); showImportDatabaseModal(); return false;" style="color: var(--secondary-color);">Import existing index</a>
                    </div>
                </div>
            </div>
        </div>
        <footer>
            <h2><span id="rotatingTagline">Build your exam reference, fast</span></h2>
        </footer>
        </div>
    </div>

    <!-- Hamburger Menu Panel (outside wrapper to avoid dimming) -->
    <nav id="menu">
        <div class="inner">
            <h2>Menu</h2>
            <ul>
                <!-- Mobile Quick Access (hidden on desktop) -->
                <li class="mobile-only"><a href="#" onclick="menuNavigate('add'); return false;">Add Entry</a></li>
                <li class="mobile-only"><a href="#" onclick="menuNavigate('view'); return false;">View Entries</a></li>
                <li class="mobile-only"><a href="#" onclick="menuNavigate('notes'); return false;">Notes</a></li>
                <li class="mobile-only"><a href="#" onclick="menuNavigate('books'); return false;">Books</a></li>
                <li class="mobile-only"><a href="#" onclick="menuNavigate('tools'); return false;">Tools</a></li>
                <li class="mobile-only"><a href="#" onclick="menuNavigate('settings'); return false;">Settings</a></li>
                <li class="mobile-only menu-divider"></li>

                <!-- Info links (all devices) -->
                <li><a href="#" onclick="showAboutModal(); return false;">About</a></li>
                <li><a href="#" onclick="showHelpModal(); return false;">Help</a></li>
                <li><a href="https://github.com/iamsgtbaker/IndexIt" target="_blank" rel="noopener">GitHub</a></li>
                <li><a href="https://buymeacoffee.com/iamsgtbaker" title="Did Index it! help get your exam pass? Show your appreciation by donating a few bucks." target="_blank" rel="noopener">‚òï Buy me a coffee</a></li>
            </ul>
        </div>
    </nav>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>